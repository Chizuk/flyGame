<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="PracticeCss.css">
    <meta charset="utf-8" />
    <title>Gamedev Canvas Workshop</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background: #eee; display: block; margin: 0 auto; }
    </style>
</head>
<body>

<canvas id="myCanvas" width="720" height="600"></canvas>

<script>
	var canvas = document.getElementById("myCanvas");
	var ctx = canvas.getContext("2d");
	var GameStyle="MainMenu"//режимы прорисовки (меню игра и пауза )
	
	
	
//-------------навигация по главному меню-----------
	var elem =document.getElementById('myCanvas'), 
		elemLeft = elem.offsetLeft,
		elemTop = elem.offsetTop;
	var MouseX,MouseY;
	
	document.addEventListener("click", function(event){
		MouseX = event.pageX - elemLeft,
        MouseY = event.pageY - elemTop;
		if(MouseX>BlockX && MouseY>StartBlockY-BlockIndent-BlockHeight && MouseX<BlockX+BlockWidth && MouseY<StartBlockY-BlockIndent){
			GameStyle="Game";
		}
	}, false);
	
	
	function ClickGame(event){
		MouseX = event.pageX - elemLeft,
        MouseY = event.pageY - elemTop;
		if(MouseX>BlockX && MouseY>StartBlockY-BlockIndent-BlockHeight && MouseX<BlockX+BlockWidth && MouseY<StartBlockY-BlockIndent){
			GameStyle="Game";
		}
	}
//---------------------меню-------------------------	
var BlockHeight=75;
var BlockWidth=150;
var BlockIndent=35;
var BlockX=(canvas.width-BlockWidth)/2;
var StartBlockY=canvas.height/2;

function DrawGameBlock(){
	ctx.beginPath();
	ctx.rect(BlockX,StartBlockY-BlockIndent-BlockHeight,BlockWidth,BlockHeight);
	ctx.fillStyle = "red";
	ctx.fill();
	ctx.closePath();
}
function DrawSettingsBlock(){
	ctx.beginPath();
	ctx.rect(BlockX,StartBlockY,BlockWidth,BlockHeight);
	ctx.fillStyle = "Yellow";
	ctx.fill();
	ctx.closePath();
}
function DrawTopBlock(){
	ctx.beginPath();
	ctx.rect(BlockX,StartBlockY+BlockIndent+BlockHeight,BlockWidth,BlockHeight);
	ctx.fillStyle = "Green";
	ctx.fill();
	ctx.closePath();
}

//---------------------игрок------------------------	
	var paddleHeight = 30;//самолет игрока (начало)
	var paddleWidth = 75;
	var paddleX = (canvas.width-paddleWidth)/2;
	var rightPressed = false;
	var leftPressed = false;
	var brickkHeight = 20;
	var brickkWidth = 50;
	document.addEventListener("keydown", keyDownHandler, false);
	document.addEventListener("keyup", keyUpHandler, false);
		function drawBrick() {
			ctx.beginPath();
			ctx.rect(paddleX, canvas.height-paddleHeight*2, brickkWidth, brickkHeight);
			ctx.fillStyle = "#DD32F1";
			ctx.fill();
			ctx.closePath();
		}
		function drawPlayer() {
			drawBrick();
			if(rightPressed) {
			paddleX += 5;}
			else if (leftPressed) {
			paddleX -= 5;}
			colision();
		}
		function colision(){
			if(paddleX<0){
				paddleX=0;
			}
			var RightCol=canvas.width-brickkWidth; 
			if (paddleX >RightCol){
				paddleX=canvas.width-brickkWidth;
			}		
		}
		function keyDownHandler (e) {
			if(e.keyCode == 39) {
			rightPressed = true;
			}
			else if (e.keyCode == 37) {
			leftPressed = true;
			}
		}
			function keyUpHandler (e) {
			if(e.keyCode == 39) {
			rightPressed = false;
			}
			else if (e.keyCode == 37) {
			leftPressed = false;
			}
		}//самолет игрока (конец)
		//keyCode: space- 32  up- 38 left- 37 right- 39 down- 40
//---------------------------- Выстрел игрока -----------------------------------------
		var bulletRadius = 5;// размеры снаряда(радиус шара)
		var BylletDY=2;
		var FireP=false;
		var Bull=0;
		document.addEventListener("keyup", PressFireUP, false);
		document.addEventListener("keydown", PressFireDOWN, false);
			//параметры для прорисовки пули игрока
		var NumderBull=10;//кол-во пуль 
		var bullArrX=[], bullArrY=[];//	масивы с координатами х и у 	
		var idBull=[];
		var Bullid;
		for(var i=0;i<NumderBull;i++){
			idBull[i]=0;
			bullArrY[i]=-100;
		}
		
		function drawBulleStart(){
		
				for(var i=0;i<NumderBull;i++){
					if(idBull[i]==0){
						Bullid=i;
					}
				}
				idBull[Bullid]=1;
				bullArrX[Bullid]=(paddleX+brickkWidth/2);
				bullArrY[Bullid]=(canvas.height-paddleHeight*2)-bulletRadius;
		}
		var DestroyB=false;
		function DestroyBull(i){
			
				if(bullArrY[i]<-6 || DestroyB){
					idBull[i]=0;
					bullArrY[i]=-250;	
					DestroyB=false;					
				}				
			}
		
		
			
		function drawBullet(){
			for(var i=0;i<NumderBull;i++){
				if(idBull[i]== 1){
					ctx.beginPath();
					ctx.arc(bullArrX[i],bullArrY[i],bulletRadius,0,Math.PI*2);//X-отступ слева,Y- сверху 
					ctx.fillStyle="#145FDD";
					ctx.fill();
					ctx.closePath;			
					bullArrY[i]-=BylletDY;		
					DestroyBull(i);
				}
			}
		}
		
		function PressFireUP (e) {
			if(e.keyCode == 32 || e.keyCode == 38) {
			FireP = true;
			drawBulleStart();
			}
		}
		
		function PressFireDOWN (e) {
			if(e.keyCode == 32 || e.keyCode == 38) {
			FireP = false;
			}
		}
//---------------------------------------------------------
//враги 
		var counter=0;//щетчик врагов
		var counterLive=0;//щетчик живых врагов
		var counterType=[0,0,0,0];//щетчик врагов разных тивов 
		
		function EnemyPilot(Type){
			this.Height=20;
			this.Width=50;
			this.typeE=Type;
			this.indent=50;
			this.Right;
			switch(Type){
				case 0: 					
					this.StartX=this.indent;
					this.Right=true;
					break;
				case 1:
					this.StartX=this.Width+this.indent*2;
					this.Right=true;
					break;
				case 2:
					this.StartX=(canvas.width-(this.Width+this.indent)*2);
					this.Right=false;
					break;
				case 3:
					this.StartX=canvas.width-(this.Width+this.indent);
					this.Right=false;
					break;			
			}
			this.StartY=0-this.Height;
			this.GoX=1;
			this.GoY=0.5;
			this.life=true;//проверка на то что самолет не уничтожен 
		}
		
		var EnemyPilots =[];
		var MaxEnemy=4;
		
		function EnemySpawn(){
			if(counterLive<MaxEnemy){
				if(counterType[0]<=counterType[1] && counterType[0]<=counterType[2] && counterType[0]<=counterType[3]){
					EnemyPilots[counter]=new EnemyPilot(0);
					counter+=1;
					counterType[0]+=1;
					counterLive+=1;
				}
				else{
					if(counterType[1]<counterType[0] && counterType[1]<=counterType[2] && counterType[1]<=counterType[3]){
						EnemyPilots[counter]=new EnemyPilot(1);
						counter+=1;
						counterLive+=1;
						counterType[1]+=1;
					}
					else{
						if(counterType[2]<counterType[0] && counterType[2]<counterType[1] && counterType[2]<=counterType[3]){
							EnemyPilots[counter]=new EnemyPilot(2);
							counter+=1;
							counterLive+=1;
							counterType[2]+=1;
						}					
						else{
							if(counterType[3]<counterType[0] && counterType[3]<counterType[2] && counterType[3]<counterType[1]){
								EnemyPilots[counter]=new EnemyPilot(3);
								counter+=1;
								counterLive+=1;
								counterType[3]+=1;
							}	
						}	
					}
				}
			}
		}
		function EnemyDraw(){
			EnemySpawn();
			for(var i=0;i<counter;i++){
				if(EnemyPilots[i].life){
					ctx.beginPath();					
					ctx.rect(EnemyPilots[i].StartX, EnemyPilots[i].StartY, EnemyPilots[i].Width, EnemyPilots[i].Height);
					ctx.fillStyle = "#0095DD";
					ctx.fill();
					ctx.closePath();	
					EnemyGo(i);
					DestroyEnemy(i);
				}
			}	
		}
		
		function EnemyGo(i){
			switch (EnemyPilots[i].typeE){
				case 0:
				if(EnemyPilots[i].Right==false){
						EnemyPilots[i].StartX-=EnemyPilots[i].GoX;
						EnemyPilots[i].StartY+=EnemyPilots[i].GoY;
						if(EnemyPilots[i].StartX<=25){
							EnemyPilots[i].Right=true;
						}
						
						break;
					}
					if(EnemyPilots[i].Right==true){
						EnemyPilots[i].StartX+=EnemyPilots[i].GoX;
						EnemyPilots[i].StartY+=EnemyPilots[i].GoY;
						if(EnemyPilots[i].StartX>=105){
							EnemyPilots[i].Right=false;
						}
						break;
					}
				case 1:
					if(EnemyPilots[i].Right==false){
						EnemyPilots[i].StartX-=EnemyPilots[i].GoX;
						EnemyPilots[i].StartY+=EnemyPilots[i].GoY;
						if(EnemyPilots[i].StartX<=205){
							EnemyPilots[i].Right=true;
						}
						
						break;
					}
					if(EnemyPilots[i].Right==true){
						EnemyPilots[i].StartX+=EnemyPilots[i].GoX;
						EnemyPilots[i].StartY+=EnemyPilots[i].GoY;
						if(EnemyPilots[i].StartX>=285){
							EnemyPilots[i].Right=false;
						}
						break;
					}
					
				case 2:
					
						if(EnemyPilots[i].Right==false){
						EnemyPilots[i].StartX-=EnemyPilots[i].GoX;
						EnemyPilots[i].StartY+=EnemyPilots[i].GoY;
						if(EnemyPilots[i].StartX<=385){
							EnemyPilots[i].Right=true;
						}
						
						break;
					}
					if(EnemyPilots[i].Right==true){
						EnemyPilots[i].StartX+=EnemyPilots[i].GoX;
						EnemyPilots[i].StartY+=EnemyPilots[i].GoY;
						if(EnemyPilots[i].StartX>=465){
							EnemyPilots[i].Right=false;
						}
						break;
					}
				case 3: 
						if(EnemyPilots[i].Right==false){
						EnemyPilots[i].StartX-=EnemyPilots[i].GoX;
						EnemyPilots[i].StartY+=EnemyPilots[i].GoY;
						if(EnemyPilots[i].StartX<=565){
							EnemyPilots[i].Right=true;
						}						
						break;
					}
					if(EnemyPilots[i].Right==true){
						EnemyPilots[i].StartX+=EnemyPilots[i].GoX;
						EnemyPilots[i].StartY+=EnemyPilots[i].GoY;
						if(EnemyPilots[i].StartX>=645){
							EnemyPilots[i].Right=false;
						}
						break;
					}
			}
		}
		function DestroyEnemy(i){
			for(var j=0;j<NumderBull;j++){
				if(bullArrX[j]>EnemyPilots[i].StartX && bullArrX[j]<(EnemyPilots[i].StartX+EnemyPilots[i].Width) && bullArrY[j]>EnemyPilots[i].StartY && bullArrY[j]<(EnemyPilots[i].StartY+EnemyPilots[i].Height)){
					EnemyPilots[i].life=false;
					counterLive-=1;
					DestroyB=true;
					DestroyBull(j);
				}		
			}
		}

//---------------------------смерть игрока-------------------------	
/*function EndGame()	{

}*/
//-----------------------------------------------------------------
		function drawGame(){
			switch(GameStyle){
				case "MainMenu":
					ctx.clearRect(0, 0, canvas.width, canvas.height);
					DrawGameBlock();
					DrawSettingsBlock();
					DrawTopBlock();
					break;
				case "Game":
					ctx.clearRect(0, 0, canvas.width, canvas.height);
					drawPlayer();//прорисовка игрока 
					drawBullet();//прорисовка выстрелов игрока		
					EnemyDraw();//прорисовка врага 
					break;
			}
		
		
		}
		
		setInterval(drawGame, 10);

		
		</script>

		
</body>
</html>
